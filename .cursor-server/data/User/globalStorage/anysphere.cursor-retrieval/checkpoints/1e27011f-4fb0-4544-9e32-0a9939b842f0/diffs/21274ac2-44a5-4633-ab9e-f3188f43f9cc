{"fsPath":"\\home\\hendo420\\soraFeed\\src\\app\\api\\feed\\latest\\route.ts","fileUuid":"21274ac2-44a5-4633-ab9e-f3188f43f9cc","fileSizeBytes":2107,"numLines":66,"diffChanges":[{"originalStartLineNumberOneIndexed":1,"originalEndLineNumberExclusiveOneIndexed":1,"modifiedStartLineNumberOneIndexed":1,"modifiedEndLineNumberExclusiveOneIndexed":67,"addedLines":["import { NextRequest, NextResponse } from 'next/server';","import { SoraFeedResponse, SoraFeedItem } from '@/types/sora';","import { getClient } from '@/lib/db';","","export async function GET(request: NextRequest) {","  try {","    const { searchParams } = new URL(request.url);","    const limit = parseInt(searchParams.get('limit') || '20');","    const offset = parseInt(searchParams.get('offset') || '0');","","    console.log('ðŸ” Fetching latest posts from database:', { limit, offset });","","    const client = await getClient();","    ","    // Query for latest posts ordered by posted_at descending","    const query = `","      SELECT ","        post_data,","        profile_data,","        text,","        posted_at,","        updated_at,","        like_count,","        view_count,","        remix_count,","        permalink","      FROM sora_posts","      WHERE post_data IS NOT NULL ","        AND profile_data IS NOT NULL","      ORDER BY posted_at DESC","      LIMIT $1 OFFSET $2","    `;","","    const result = await client.query(query, [limit, offset]);","    ","    // Transform database results to SoraFeedItem format","    // eslint-disable-next-line @typescript-eslint/no-explicit-any","    const items: SoraFeedItem[] = result.rows.map((row: any) => ({","      post: row.post_data,","      profile: row.profile_data,","    }));","","    console.log(`âœ… Found ${items.length} latest posts from database`);","","    // Check if there are more items for pagination","    const countQuery = 'SELECT COUNT(*) as total FROM sora_posts WHERE post_data IS NOT NULL AND profile_data IS NOT NULL';","    const countResult = await client.query(countQuery);","    const totalCount = parseInt(countResult.rows[0].total);","    const hasMore = (offset + limit) < totalCount;","","    const response: SoraFeedResponse = {","      items,","      cursor: hasMore ? (offset + limit).toString() : null,","    };","","    return NextResponse.json(response);","","  } catch (error) {","    console.error('ðŸ’¥ Database latest feed error:', error);","    return NextResponse.json(","      { error: 'Internal server error', message: error instanceof Error ? error.message : 'Unknown error' },","      { status: 500 }","    );","  }","}",""],"tokenizedAddedLines":[1000000,1000001,1000002,1000003,1000004,1000005,1000006,1000007,1000008,1000003,1000009,1000003,1000010,1000011,1000012,1000013,1000014,1000015,1000016,1000017,1000018,1000019,1000020,1000021,1000022,1000023,1000024,1000025,1000026,1000027,1000028,1000029,1000003,1000030,1000011,1000031,1000032,1000033,1000034,1000035,1000036,1000003,1000037,1000003,1000038,1000039,1000040,1000041,1000042,1000003,1000043,1000044,1000045,1000046,1000003,1000047,1000003,1000048,1000049,1000050,1000051,1000052,1000053,1000054,1000055,1000003]}],"gitInfo":{"noRepoFound":true},"kind":"KIND_ADDED"}